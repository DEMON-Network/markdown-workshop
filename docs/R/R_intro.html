<h1>Literate programming and RMarkdown</h1>
<p>Let's start with the definition of literate programming (from <a href="https://en.wikipedia.org/wiki/Literate_programming">Wikipedia</a>):</p>
<p><em>Literate programming is a programming paradigm introduced by Donald Knuth in which a computer program is given an explanation of its logic in a natural language, such as English, interspersed with snippets of macros and traditional source code, from which compilable source code can be generated.</em></p>
<p>RMarkdown is a method for performing literate programming and is a powerful way of presenting your analysis in a way that's easy to code and easy to read. The <em>"snippets of macros and traditional source code"</em> are your <code>R</code> analysis code. The <em>"explanation of the its logic in a natural language"</em> is your analysis report.  </p>
<p>This lesson will draw heavily from the following excellent resources:</p>
<blockquote>
<h2>RMarkdown further reading</h2>
<p>These are all from the RStudio website:
* <a href="https://rmarkdown.rstudio.com/lesson-1.html">Get Started with RMarkdown</a> - An extensive tutorial
* <a href="https://rstudio.com/wp-content/uploads/2015/03/rmarkdown-reference.pdf">Reference (pdf)</a> - A 5 page reference of commands and concepts. 
* <a href="https://rstudio.com/wp-content/uploads/2016/03/rmarkdown-cheatsheet-2.0.pdf">Cheatsheet (pdf)</a> - A 2 page summary of the most important elements. </p>
</blockquote>
<h2>RMarkdown - what is it?</h2>
<p><strong>Markdown</strong> is a simple plain-text language that can be turned into formatted text, e.g., webpages, forum posts (stackexchange, Github) etc. </p>
<p><strong>RMarkdown</strong> is a variant of <code>Markdown</code> which allows you to incorporate code  within the
final document. It can be turned into HTML, pdfs, word documents, books, theses etc. as well. </p>
<p>The Carpentries courses (i.e., this course) are written <code>RMarkdown</code> and <code>Markdown</code>. </p>
<h2>RMarkdown -  what's it good for?</h2>
<p>Consider your normal data analysis workflow. It's probably something like this:</p>
<h4>1. Conventional workflow</h4>
<ol>
<li>Do some data analysis in an <code>R</code> script. Use comments to help reader understand. </li>
<li>Save plots, tables, etc. in separate files (<code>fig1.png</code>, <code>tab1.csv</code>, etc.). </li>
<li>Write report in Word and insert figures, tables etc. </li>
</ol>
<p><em>Updating/changing analysis</em>: Edit <code>R</code> scripts, Word document, insert figures, potentially change figure lables, <code>fig1.png</code>-&gt; <code>fig2.png</code> etc..  </p>
<p><em>Sharing analysis</em>: Share data, R scripts, plots, tables, Word/Latex files. Also include how all the parts relate to each other in a README. </p>
<p>With <code>RMarkdown</code> your workflow will be more like this: </p>
<h4>2. Literate programming workflow</h4>
<ol>
<li>Do some data analysis in an <code>RMarkdown</code> file. All figures, tables are displayed in line - no need to save sepate files.  </li>
<li>Write your report around the code in the <code>RMarkdown</code> file. The narrative of the analysis helps the reader understand the code.  </li>
<li>One-click to create formatted Word/HTML/pdf report, or, one-click to publish to the web (requires setup - not covered in this course).  </li>
</ol>
<p><em>Updating/changing analysis</em>: Edit the single <code>RMarkdown</code> file and click to create report. </p>
<p><em>Sharing analysis</em>: Share data and the single <code>RMarkdown</code> file. </p>
<p>This difference can be seen in the figure below which shows two directory structures the top 
with the conventional workflow, the bottom with the literate programming workflow. </p>
<p>Of course for larger projects, you may have more than one <code>RMarkdown</code> file and you may have separate analysis scripts as well. An additional <em>major</em> benefit over writing documents in Word is that you can track changes with version control. </p>
<h2>RMarkdown - quick start</h2>
<p>Let's create a quick-n-dirty RMarkdown document</p>
<blockquote>
<h2>Create an RMarkdown file</h2>
<ol>
<li>Select <code>File</code> &gt; <code>New File</code> &gt; <code>R Markdown...</code></li>
<li><code>Title</code>: <code>Example Report</code></li>
<li><code>Author</code>: [Your name]</li>
<li><code>Default Output Format</code>: <code>HTML</code></li>
<li>Click <code>OK</code> (not <code>Create Empty Document</code>).<br />
{: .challenge}</li>
</ol>
</blockquote>
<p>You should see in your code editing pane a <code>RMarkdown</code> file called <code>Untitled1</code> with the following at 
the top: 
~~~</p>
<hr />
<p>title: "Example Report"
   author: "Your Name"
   date: "25/11/2019"
   output: html_document</p>
<hr />
<p>~~~
{: .source}</p>
<p>This is the 'front matter' - a collection of key/value pairs tells R how you want to process the output. The front matter is a powerful way of customising your document and you should consult the RStudio tutorial to find out more about this. The <code>RMarkdown</code> file needs to be saved and processed to create the final report, let's do this now. </p>
<blockquote>
<h2>Save and process the report</h2>
<ol>
<li>Select <code>File</code> &gt; <code>Save</code></li>
<li><code>File Name:</code> <code>example_report</code></li>
<li>Click the <code>Knit</code> button (you'll need to enable pop-ups in your Browser if you're using <code>RStudio cloud</code>)</li>
<li><code>RStudio cloud</code> the output will be in a new tabl </li>
<li><code>RStudio local</code> the output will be in the <code>Viewer</code> pane. 
{: .challenge}</li>
</ol>
</blockquote>
<p>Before going on to explain RMarkdown, you should spend some time by yourself comparing the inputs
outputs:</p>
<blockquote>
<h2>Compare inputs/outputs</h2>
<p>Take a few minutes to read through the file <code>Example_report.Rmd</code> and look at the output
in a browser tab/<code>Viewer</code> pane. Answer these three questions: 
1. What does <code>**</code> do to text? 
2. How do you denote headings? 
3. How do you insert code? </p>
<blockquote>
<h2>Solution</h2>
<ol>
<li>Makes text bold. </li>
<li>With hashtags/octothorps/pound symbols: <kbd>#</kbd>. </li>
<li>Inbetween three back apostrophes: <kbd>`</kbd>. 
{: .solution}
{: .challenge}</li>
</ol>
</blockquote>
</blockquote>
<h2>RMarkdown - syntax</h2>
<p>What follows is a non-comprehensive guide to RMarkdown syntax. The <code>code</code> blocks show the RMarkdown syntax, and underneath is the output. Read through it and then you can proceed to the exercise at the end.  </p>
<h3>Headings</h3>
<h4>Input</h4>
<p>~~~
    # Heading 1
    ## Heading 2
    ### Heading 3
~~~
{: .source}</p>
<h4>Output</h4>
<h1>Heading 1</h1>
<h2>Heading 2</h2>
<h3>Heading 3</h3>
<h3>Lists</h3>
<p>Note - actual numbers don't matter, just have a number and a period <code>.</code> The sub-items have been indented by a tab space.  </p>
<h4>Input</h4>
<p>~~~
    1. Item 1
    1. Item 2
      1. sub Item 1
      3. sub Item 2
    2. Item 3
~~~
{: .source}</p>
<h4>Output</h4>
<ol>
<li>Item 1</li>
<li>Item 2<ol>
<li>sub Item 1</li>
<li>sub Item 2</li>
</ol>
</li>
<li>Item 3</li>
</ol>
<h3>Bullets</h3>
<h4>Input</h4>
<p>~~~
    * Item 1
    * Item 2
        * sub Item 1
        * sub Item 2
    * Item 3
~~~
{: .source}</p>
<h4>Output</h4>
<ul>
<li>Item 1</li>
<li>Item 2<ul>
<li>sub Item 1</li>
<li>sub Item 2</li>
</ul>
</li>
<li>Item 3</li>
</ul>
<h3>Links</h3>
<h4>Input</h4>
<p>~~~
<a href="www.google.com">link text</a>
~~~~
{: .source}</p>
<h4>Output</h4>
<p><a href="www.google.com">link text</a></p>
<h3>Images</h3>
<h4>Input</h4>
<p>~~~~
<img alt="very good science caption" src="../fig/verygoodscience-hex.png" />
~~~
{: .source}</p>
<h4>Output</h4>
<p><img alt="very good science caption" src="../fig/verygoodscience-hex.png" /></p>
<h3>Code chunks</h3>
<h4>Input</h4>
<p>You can also include code in code  and the output of code in 'code chunks'.</p>
<p><code>markdown
`r ''</code>{r}
x &lt;- rnorm(2)</p>
<p>for(i in 1:length(x)){
  print(x[[i]])
}
```
````</p>
<p>You run the code by clicking the little triangle icon in the top right.</p>
<h4>Output</h4>
<p>This prints the code and the result:
```{r}
x &lt;- rnorm(2)</p>
<p>for(i in 1:length(x)){
  print(x[[i]])
}
```</p>
<h3>Plots</h3>
<p>As you can tell from the example document we <code>knit</code>ed at the start you can also show plots:</p>
<h4>Input</h4>
<p><code>markdown
```r ''`{r}
library(ggplot2)
x &lt;- rbeta(1000,5,2)
y &lt;- rbeta(1000,0.3, 0.3)
ggplot(data.frame(x,y), aes(x=x, y=y)) + geom_point()
}
```</code></p>
<h4>Output</h4>
<p>gives the following code and plot
~~~
library(ggplot2)
x &lt;- rbeta(1000,5,2)
y &lt;- rbeta(1000,0.3, 0.3)
ggplot(data.frame(x,y), aes(x=x, y=y)) + geom_point()
~~~
{: .language-r}
<img alt="beta correlation" src="../fig/beta_correlation.png" /></p>
<h3>Inline code</h3>
<p>You can also put code inline with text. </p>
<h4>Input</h4>
<p><code>markdown
```r ''`{r}
x &lt;- rbeta(1000,5,2)
```</code></p>
<p>The mean of the observations is <code>`r knitr::inline_expr("mean(x)")`</code></p>
<h4>Output</h4>
<p><code>{r}
x &lt;- rbeta(1000,5,2)</code></p>
<p>The mean of the observations is <code>r mean(x)</code>. </p>
<h2>Exercise</h2>
<blockquote>
<h2>Reproduce and extend an analysis.</h2>
<p>A small piece of exploratory analysis was done on the <code>oasis</code> dataset. While it was done in <code>RMarkdown</code> only the a html document is available. You want to reproduce and update this analysis. 
1. View the html report <a href="DEMON-Network.github.io/markdown-workshop/R/Example-Reproducible-Reporting-using-Markdown.html">here</a>, extract it and open it in a browser. 
1. Create a fresh RMarkdown document and reproduce the given report. You'll need to look at the cheat-sheet <a href="https://rstudio.com/wp-content/uploads/2016/03/rmarkdown-cheatsheet-2.0.pdf">here</a> and you can copy and paste chunks of text if you wish. 
2. Add another section entitled 'Updated analysis' which makes the plot mentioned in the 'further work' section. Comment on the chart. 
2. Knit to a pdf by selecting <code>Knit to pdf</code> from the <code>Knit</code> menu. How does the front matter change? </p>
<blockquote>
<h2>Solution</h2>
<p>The <code>RMarkdown</code> file used for the full analysis (including the 'Updated analysis')
can be downloaded <a href="https://gist.github.com/RobertArbon/51a6622ac67609e98fafc1f1b6b764ad">here</a>. Download it and compare it to yours.
In the front matter an additional <code>pdf_document</code> has been added as part of an indented list under <code>output</code>.<br />
{: .solution}
{: .challenge}</p>
</blockquote>
</blockquote>
<p>There's lots more that can be done with RMarkdown, please read go through the tutorial to find out more. You'll also have a chance to play around with it in <a href="{{ page.root }}{% link _episodes/05-putting-it-together.md %}">episode 5</a>. </p>